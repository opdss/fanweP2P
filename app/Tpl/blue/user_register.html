{include file="inc/header.html"}
<div class="blank20"></div>
<div class="regstep regstep_t">
            <ol class="ui-step ui-step-3">
                <li class="ui-step-start ui-step-active">
                    <div class="ui-step-line">-</div>
                    <div class="ui-step-icon">
                        <i class="iconfont"></i>
                        <i class="ui-step-number">1</i>
                        <span class="ui-step-text">填写账户信息</span>
                    </div>
                </li>
                <li>
                    <div class="ui-step-line">-</div>
                    <div class="ui-step-icon">
                        <i class="iconfont"></i>
                        <i class="ui-step-number">2</i>
                        <span class="ui-step-text">实名信息</span>
                    </div>
                </li>
                <li class="ui-step-end">
                    <div class="ui-step-line">-</div>
                    <div class="ui-step-icon">
                        <i class="iconfont"></i>
                        <i class="ui-step-number">3</i>
                        <span class="ui-step-text">注册成功</span>
                    </div>
                </li>
            </ol>
</div>
        
<div class="blank20"></div>
<div class="wrap">
	<div class="bdd bddf">
		<div class="user-lr-box f_l pt50 pl30 pb30" style="width:590px">
			<!--手机和邮箱注册表单-->
		
			<form action="{url x="index" r="user#doregister"}" method="post" id="signup-user-form" autocomplete="off">
				<div class="field usertype">
					<label for="signup-usertype"><span class="f_red">*</span> 帐号类型</label>
					<div class="f_l  pt10">
						<label class="ui-radiobox" rel="common_user_type">
							<input type="radio" name="user_type" value="0" checked="checked" style="visibility:visible;display:none" />
							普通会员
						</label>
						<label class="ui-radiobox" rel="common_user_type">
							<input type="radio" class="ui-radiobox"  name="user_type" value="1"  style="visibility:visible;display:none" />
							企业会员
						</label>
					</div>
					<div class="blank0"></div>
				</div>
				<div class="blank10"></div>
				<div class="field username">
					<label for="signup-username"><span class="f_red">*</span> {$LANG.USER_TITLE_USER_NAME}</label>
					<div class="f_l frbox pr">
						<div class="u_icon">
							<i class="iconfont">&#xe623;</i>
						</div>
						<input type="text" value="{$reg_name}" class="f-input ui-textbox" holder="输入注册帐号" id="signup-username" name="user_name" size="30">
						<span class="f-input-tip"></span> 
						<span class="hint">{$LANG.USER_TITLE_USER_NAME_TIP}</span> 
					</div>
					<div class="blank0"></div>
				</div>
				<div class="blank10"></div>
				{if (app_conf("REGISTER_TYPE") eq 0 || app_conf("REGISTER_TYPE") eq 1)}		
					<div class="field mobile">
						<label for="signup-mobile"><span class="f_red">*</span> {$LANG.USER_TITLE_MOBILE}</label>
						<div class="f_l frbox pr">
							<div class="u_icon">
								<i class="iconfont">&#xe626;</i>
							</div>
							<input type="text" value="" holder="输入手机号码" class="f-input ui-textbox" id="settings-mobile" name="mobile" size="30">
							<span class="f-input-tip"></span> 
							<span class="hint"> {$LANG.USER_TITLE_MOBILE_TIP}</span>
						</div>
						<div class="blank0"></div>
					</div>
					<div class="blank10"></div>
					{if ( app_conf("USER_VERIFY") eq 0 || app_conf("USER_VERIFY") eq 2)}
					<div class="field verify">
						<label >手机验证码</label>
						<div class="f_l frbox pr">
							<input type="text" value="" class="f-input ui-textbox"  name="sms_code" >
							<input type="button" value="获取验证码" class="sendsms_button f_l btn_disable " id="get_regsms_code" class="ml5 f_l"  />
							<span class="f-input-tip"></span> 
							<span class="hint"> 输入收到的手机验证码</span>
						</div>
						<div class="blank0"></div>
					</div>
					{/if}
					<div class="blank10"></div>
				{/if}
				
				{if (app_conf("REGISTER_TYPE") eq 0 || app_conf("REGISTER_TYPE") eq 2)}	
					<div class="field email">
						<label for="signup-email-address"><span class="f_red">*</span> {$LANG.USER_TITLE_EMAIL}</label>
						<div class="f_l frbox pr">
							<div class="u_icon">
								<i class="iconfont">&#xe624;</i>
							</div>
							<input type="text" value="" class="f-input ui-textbox" holder="输入常用的邮箱" id="signup-email-address" name="email" size="30">
							<span class="f-input-tip"></span> 
							<span class="hint">{$LANG.USER_TITLE_EMAIL_TIP}</span>
						</div>
						<div class="blank0"></div>
					</div>
					<div class="blank10"></div>
					{if ( app_conf("USER_VERIFY") eq 1 || app_conf("USER_VERIFY") eq 2) }
					<div class="field verify ">
						<label >邮箱验证码</label>
						<div class="f_l frbox pr">
							<input type="text" value="" class="f-input ui-textbox"  name="emsms_code" >
							<input type="button" value="获取验证码" class="sendsms_button f_l btn_disable " id="get_emregsms_code" class="ml5 f_l"  />
							<span class="f-input-tip"></span> 
							<span class="hint"> 输入收到的邮箱验证码</span>
						</div>
						<div class="blank0"></div>
					</div>
					{/if}
					<div class="blank10"></div>
				{/if}
			
				
				<div class="field password">
					<label for="signup-password"><span class="f_red">*</span> {$LANG.USER_TITLE_USER_PWD}</label>
					<div class="f_l frbox pr">
						<div class="u_icon">
							<i class="iconfont">&#xe625;</i>
						</div>
						<input type="password" class="f-input ui-textbox" holder="输入密码" id="signup-password" size="30">
						<span class="f-input-tip"></span> 
						<input type="hidden" id="signup-password-ipt" name="user_pwd">
						<span class="hint">{$LANG.USER_TITLE_USER_PWD_TIP}</span>
					</div>
					<div class="blank0"></div>
				</div>
				<div class="blank10"></div>
				<div class="field password">
					<label for="signup-password-confirm"><span class="f_red">*</span> {$LANG.USER_TITLE_USER_CONFIRM_PWD}</label>	
					<div class="f_l frbox pr">
						<div class="u_icon">
							<i class="iconfont">&#xe625;</i>
						</div>
						<input type="password" class="f-input ui-textbox" holder="再次输入密码" id="signup-password-confirm"size="30">
						<input type="hidden" id="signup-password-confirm-ipt" name="user_pwd_confirm">
						<span class="f-input-tip"></span>
						<span class="hint">请再次填写密码</span>
					</div>
					<div class="blank0"></div>
				</div>
				<div class="blank10"></div>
				
				{foreach from=$field_list item=field_item}
				<div class="field weibo">
					<label id="{$field_item.field_name}_label">{$field_item.field_show_name}</label>
					<div class="f_l frbox pr">
						{if $field_item.input_type eq 0}
						<input type="text" value="" class="f-input ui-textbox" holder="输入{$field_item.field_show_name}" id="settings-{$field_item.field_name}" name="{$field_item.field_name}" size="30">
						{/if}
						
						{if $field_item.input_type eq 1}
						<select id="settings-{$field_item.field_name}" name="{$field_item.field_name}">
							{foreach from=$field_item.value_scope item=value_item}
							<option value="{$value_item}">{$value_item}</option>
							{/foreach}
						</select>
						{/if}
						<span class="f-input-tip">&nbsp;</span>
						<span class="hint">{if $field_item.is_must eq 1}请输入{$field_item.field_show_name}{else}&nbsp;{/if}</span>
					</div>
					<div class="blank0"></div>
				</div>
				<div class="blank10"></div>
				{/foreach}
				
				{if app_conf("VERIFY_IMAGE") eq 1 && app_conf("USER_VERIFY") gte 3}
				<div class="field verify">
					<label>&nbsp;</label>
					<div class="f_l frbox pr">
						<div class="verify_row">
						<input type="text" value="" class="f-input ui-textbox f_l" name="verify" onfocus="$('#signup-user-email-form #JverifyImg').attr('src','{$APP_ROOT}/verify.php?w=89&h=44&rand='+ Math.random());"  />	
						<img class="ml10 f_l" src="{$APP_ROOT}/verify.php?w=89&h=44&rand={function name="rand"}" id="JverifyImg" onclick="this.src='{$APP_ROOT}/verify.php?w=89&h=44&rand='+ Math.random();" title="看不清楚？换一张" />			
						</div>
						<span class="hint">请输入验证码</span>
					</div>
					<div class="blank0"></div>
				</div>
				<div class="blank10"></div>
				{/if}
				{if app_conf("INVITE_REFERRALS") eq 1}
				<div class="field weibo {if $referer neq ''}hide{/if}">
					<label from="settings-referer">推荐人</label>
					<div class="f_l frbox pr">
						<input type="text" value="{$referer}" holder="输入推荐人手机号/会员名/备注" class="f-input ui-textbox" id="settings-referer" name="referer" >
						<span class="f-input-tip">&nbsp;</span>
						<span class="hint">可输入推荐人手机号码或会员名，或者备注。</span>
					</div>
					<div class="blank0"></div>
				</div>
				<div class="blank10"></div>
				{/if}
				
				<div class="field agreementf14">
					<label>&nbsp;</label>
					<label class="ui-checkbox mt5" rel="agreement" style="float:left!important;">
						<input type="checkbox" name="agreement" id="J_agreement" value="1" checked="checked" />
					</label>
					<div class="f_l">
						同意 <a href="{url x="index" r="help" p="id=$agreement"}" class="f_blue">注册协议</a> 和 <a href="{url x="index" r="help" p="id=$privacy"}" class="f_blue">隐私条款</a>
					</div>
					<div class="blank0"></div>
				</div>
				<div class="blank10"></div>
				<div class="act">
					<input type="submit" class="btn_blue w180 f_white f18 b p10 bdr3 reg-submit-btn" id="signup-mobile-submit" name="commit" value="{$LANG.REGISTER}">				
				</div>
				<div class="blank20"></div>
				<div class="blank20"></div>
			</form>
		</div>
		<div class="f_r">
			<div class="has_account tc pb15 f14">已有帐号？<a href="{url x="index" r="user#login"}" class="f_blue">直接登录</a></div>
		</div>
		<div class="blank0"></div>
	</div>	
</div>

<script type="text/javascript">
{if app_conf("USER_VERIFY") lt 3}

var regsiter_vy_time = null;  	//定义时间
var is_lock_send_vy = false;	//解除锁定
var left_rg_time = 0;			//开始时间

function left_time_to_send_regvy(){
	clearTimeout(regsiter_vy_time);
	if(left_rg_time > 0){
		regsiter_vy_time = setTimeout(left_time_to_send_regvy,1000);
		$("#get_regsms_code").val(left_rg_time+"秒后重新获取验证码");
		$("#get_regsms_code").addClass("btn_disable");
		left_rg_time -- ;
	}
	else{
		is_lock_send_vy = false;
		$("#get_regsms_code").removeClass("btn_disable");
		$("#get_regsms_code").val("重新获取验证码");
		
		left_rg_time = 0;
	}
}

var regsiter_vy_times = null;  	//定义时间
var is_lock_send_vys = false;	//解除锁定
var left_rg_times = 0;			//开始时间
function left_time_to_send_regvys(){
	clearTimeout(regsiter_vy_times);
	if(left_rg_times > 0){
		regsiter_vy_times = setTimeout(left_time_to_send_regvys,1000);
		$("#get_emregsms_code").val(left_rg_times+"秒后重新获取验证码");
		$("#get_emregsms_code").addClass("btn_disable");
		left_rg_times -- ;
	}
	else{
		is_lock_send_vys = false;
		$("#get_emregsms_code").removeClass("btn_disable");
		$("#get_emregsms_code").val("重新获取验证码");
		left_rg_times = 0;
	}
}
{/if}

$(document).ready(function(){
	$("#get_regsms_code").click(function(){
			if(is_lock_send_vy || $(this).hasClass(".btn_disable")){
				return false;
			}
			is_lock_send_vy = true;
			if(!$.maxLength($("#settings-mobile").val(),11,true))
			{
				is_lock_send_vy = false;
				 if (window.PIE) {
					 formError($("#settings-mobile").parent(),"长度不能超过11位");
					 }else{
				formError($("#settings-mobile"),"长度不能超过11位");
				 }
				return false;
			}
			
			if($.trim($("#settings-mobile").val()).length == 0)
			{			
				is_lock_send_vy = false;
				 if (window.PIE) {
					 
					 formError($("#settings-mobile").parent(),"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");
					 }else{
				formError($("#settings-mobile"),"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");
				 }
				
				return false;
			}	
			
			if(!$.checkMobilePhone($("#settings-mobile").val()))
			{
				is_lock_send_vy = false;
				 if (window.PIE) {
					 formError($("#settings-mobile").parent(),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");	
					 
					 }else{
				
				formError($("#settings-mobile"),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");	
				 }
				return false;
			}	
			var ajaxurl = APP_ROOT+"/index.php?ctl=ajax&act=get_register_verify_code";
			
			
			var query = new Object();
			query.user_mobile =  $.trim($("#settings-mobile").val());
			$.ajax({ 
				url: ajaxurl,
				data:query,
				type: "POST",
				dataType: "json",
				success: function(result){
					if(result.status==1)
					{
						left_rg_time = 60;
						left_time_to_send_regvy();
						$.showSuccess(result.info,function(){
							to_send_msg = true;
						});
					}
					else
					{	
						is_lock_send_vy = false;
						
						 if (window.PIE) {
							 
							 formError($("#settings-mobile").parent(),result.info);
							 }else{
							
							formError($("#settings-mobile"),result.info);
							}
						
						
						
						return false;
					}
				},error:function(){
					is_lock_send_vy = false;
				}
			});	
		}); //发送手机验证码
		
		
		$("#get_emregsms_code").click(function(){
			if(is_lock_send_vys || $(this).hasClass(".btn_disable")){
				return false;
			}
			is_lock_send_vys = true;
			if($.trim($("#signup-email-address").val()).length == 0)
			{	
				is_lock_send_vys = false;
				formError($("#signup-email-address"),"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");			
				return false;
			}
			if(!$.checkEmail($("#signup-email-address").val()))
			{
				is_lock_send_vys = false;
				
				 if (window.PIE) {
					 
					 formError($("#signup-email-address").parent(),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");
					 
					 }else{
				
				formError($("#signup-email-address"),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");
				
				}
				
				
				
				
				return false;
			}	
			var ajaxurl = APP_ROOT+"/index.php?ctl=ajax&act=get_email_verify";
			var query = new Object();
			query.user_email =  $("#signup-email-address").val();
			$.ajax({ 
				url: ajaxurl,
				data:query,
				type: "POST",
				dataType: "json",
				success: function(result){
					if(result.status==1)
					{
						left_rg_times = 60;
						left_time_to_send_regvys();
						$.showSuccess(result.info,function(){
							to_send_msg = true;
						});
					}
					else
					{	
						is_lock_send_vys = false;
						 if (window.PIE) {
							 formError($("#signup-email-address").parent(),result.info);
							 
							 }else{
						formError($("#signup-email-address"),result.info);
					
						 }
						return false;
					}
				}
			});	
		}); //发送邮箱验证码
		
		
		
		
		
	
	{if (app_conf("REGISTER_TYPE") eq 0 || app_conf("REGISTER_TYPE") eq 2)}	
	$("#signup-email-address").bind("blur",function(){
		var obj = $(this);
		if($.trim(obj.val()).length == 0)
		{
			 if (window.PIE) {
				 formError(obj.parent(),"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");
				 
				 }else{
			
			formError(obj,"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");
			}
						
			return false;
		}
		if(!$.checkEmail(obj.val()))
		{
			 if (window.PIE) {
				 
				 	formError(obj.parent(),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");
				 
				 }else{
				
					formError(obj,"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");
				
				}
		
			return false;
		}	
		var ajaxurl = APP_ROOT+"/index.php?ctl=ajax&act=check_field";
		var query = new Object();
		query.field_name = "email";
		query.field_data = $.trim(obj.val());
		$.ajax({ 
			url: ajaxurl,
			data:query,
			type: "POST",
			dataType: "json",
			success: function(data){
				if(data.status==1)
				{
					 if (window.PIE) {
						 formSuccess($("#signup-email-address").parent(),"{$LANG.CAN_USED}");
						 }else{
					formSuccess($("#signup-email-address"),"{$LANG.CAN_USED}");
						 }
					$("#get_emregsms_code").removeClass("btn_disable");
					return false;
				}
				else
				{
					 if (window.PIE) {
						 	formError($("#signup-email-address").parent(),data.info);
						  }else{
						formError($("#signup-email-address"),data.info);
					}
					return false;
				}
			}
		});	
	});
	{/if}
	//邮箱验证
	
	{if (app_conf("REGISTER_TYPE") eq 0 || app_conf("REGISTER_TYPE") eq 1)}	
	$("#settings-mobile").bind("blur",function(){
		var obj = $(this);
		$("#get_regsms_code").addClass("btn_disable");
		if(!$.checkMobilePhone(obj.val()))
		{
			if (window.PIE) {
			formError(obj.parent(),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");	
			 }else{
				 formError(obj,"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");	
				 }
			return false;
		}	
		if($.trim(obj.val()).length == 0)
		{		
		if (window.PIE) {	
			formError(obj.parent(),"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");
		 }else{	
			formError(obj,"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");
		 }
			return false;
		}
		var ajaxurl = APP_ROOT+"/index.php?ctl=ajax&act=check_field";
		var query = new Object();
		query.field_name = "mobile";
		query.field_data = $.trim(obj.val());
		$.ajax({ 
			url: ajaxurl,
			data:query,
			type: "POST",
			dataType: "json",
			success: function(data){
				if(data.status==1)
				{
					if(query.field_data!='')
					if (window.PIE) {
						formSuccess(obj.parent(),"{$LANG.CAN_USED}");
					 }else{		
						formSuccess(obj,"{$LANG.CAN_USED}");
					 }
					else
					if (window.PIE) {
						formSuccess(obj.parent(),"");
						 }else{		
					formSuccess(obj,"");
					 }
					
					
					$("#get_regsms_code").removeClass("btn_disable");
					return false;
				}
				else
				{			
				if (window.PIE) {	
				formError(obj.parent(),data.info);
					 }else{	
					formError(obj,data.info);
					}
					
					return false;
				}
			}
		});	
	}); 
	{/if}
	//手机验证
	

	$("#signup-mobile-submit").click(function(){
		
		var name;
		name=$.trim($("#signup-user-form #signup-password").val())

		var reg=/^[a-zA-z0-9]{6,}$/;  
		var regs=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;
		if(reg.test(name)){	
		
			if(regs.test(name)){	
				//alert("4545");
				 if (window.PIE) {
					 formSuccess($("#signup-user-form #signup-password").parent(),"{$LANG.CAN_USED}");
				  }else{
					formSuccess($("#signup-user-form #signup-password"),"{$LANG.CAN_USED}");

				  }
			}
			else{
				 if (window.PIE) {
					formError($("#signup-user-form #signup-password").parent(),"安全等级低，请用数字+字母");
					}else{
				formError($("#signup-user-form #signup-password"),"安全等级低，请用数字+字母");
				 }
				return false;
			}
		}
		else{
			 if (window.PIE) {
				formError($("#signup-user-form #signup-password").parent(),"长度在6~16之间，只能包含字符、数字和下划线。") 
				 }else{
			formError($("#signup-user-form #signup-password"),"长度在6~16之间，只能包含字符、数字和下划线。")
			;}
			return false;
		}
		if(!$.minLength($("#signup-user-form #signup-password").val(),6,false))
		{
			 if (window.PIE) {
				 formError($("#signup-user-form #signup-password").parent(),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_PWD}");	
				 }else{
			formError($("#signup-user-form #signup-password"),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_PWD}");	
			 }
			return false;
		}
		var objform = $(this).parent().parent();
		checkRegsiter(objform);
	});//单击提交
	
	
	$("#signup-user-form input,#signup-user-form select").keydown(function(e){ 
		var objform = $(this).parent().parent();
		var curKey = e.which; 
		if(curKey == 13){
			checkRegsiter(objform);
		}; 
	});
	
	

	
	
	$("#signup-user-form #signup-username").bind("blur",function(){
		var obj = $(this);
		if(!$.minLength(obj.val(),3,true))
		{
			 if (window.PIE) {
				 formError(obj.parent(),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_NAME}");	
			 }else{
			formError(obj,"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_NAME}");	
			 }
			return false;
		}
		
		if(!$.maxLength(obj.val(),16,true))
		{
			 if (window.PIE) {
				 formError(obj.parent(),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_NAME}");
				 }else{
			formError(obj,"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_NAME}");
			 }
			return false;
		}	
		
		var ajaxurl = APP_ROOT+"/index.php?ctl=ajax&act=check_field";
		var query = new Object();
		query.field_name = "user_name";
		query.field_data = $.trim(obj.val());
		$.ajax({ 
			url: ajaxurl,
			data:query,
			type: "POST",
			dataType: "json",
			success: function(data){
				if(data.status==1)
				{
					 if (window.PIE) {
						 formSuccess(obj.parent(),"{$LANG.CAN_USED}");
						 }else{
					formSuccess(obj,"{$LANG.CAN_USED}");
					 }
					return false;
				}
				else
				{
					if (window.PIE) {
						formError(obj.parent(),data.info);
						 }else{
					formError(obj,data.info);
					 }
					return false;
				}
			}
		});	
	}); //用户名验证
	
	
	$("#signup-user-form #signup-password").bind("blur",function(){
		var obj = $(this);
		var name;
		name=$.trim(obj.val())
		var reg=/^[a-zA-z0-9]{6,}$/;  
		var regs=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;
		if(reg.test(name)){	
			if(regs.test(name)){	
				if (window.PIE) {
					formSuccess(obj.parent(),"{$LANG.CAN_USED}");
				}else{
					formSuccess(obj,"{$LANG.CAN_USED}");
				}
				
			}
			else{
				if (window.PIE) {
					formError(obj.parent(),"安全等级低，请用数字+字母");
				}else{
					formError(obj,"安全等级低，请用数字+字母");
				}
				return false;
			}
		}
		else{
			if (window.PIE) {
				formError(obj.parent(),"长度在6~16之间，只能包含字符、数字和下划线。");
			}else{
				formError(obj,"长度在6~16之间，只能包含字符、数字和下划线。");
			}
			return false;
		}
		if(!$.minLength(obj.val(),6,false))
		{
			if (window.PIE) {
				formError(obj.parent(),"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_PWD}");
			}else{
				formError(obj,"{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_PWD}");	
			}
			return false;
		}
		
		if (window.PIE) {
			obj.parent().parent().find("#signup-password-ipt").val(obj.val());
			formSuccess(obj.parent(),"{$LANG.CAN_USED}");
		}else{
			obj.parent().find("#signup-password-ipt").val(obj.val());
			formSuccess(obj,"{$LANG.CAN_USED}");
		}
		
	}); //密码验证

	$("#signup-user-form #signup-password-confirm").bind("blur",function(){
		var obj = $(this);
		if(obj.val()!==""){
			if (window.PIE) {
				if(obj.val() != obj.parent().parent().parent().parent().find("#signup-password").val())
				{
						formError(obj.parent(),"{$LANG.USER_PWD_CONFIRM_ERROR}");	
						return false;
				}
			}else{
				if(obj.val() != obj.parent().parent().parent().find("#signup-password").val())
				{
						formError(obj,"{$LANG.USER_PWD_CONFIRM_ERROR}");
						return false;
				}
				
			}	
		}
		else{
			if (window.PIE) {
				formError(obj.parent(),"请输入确认密码");
			}else{
				formError(obj,"请输入确认密码");
			}	
			return false;
		}
	
		if (window.PIE) {
			obj.parent().parent().find("#signup-password-confirm-ipt").val(obj.val());
			formSuccess(obj.parent(),"{$LANG.VERIFY_SUCCESS}");
		}else{
			obj.parent().find("#signup-password-confirm-ipt").val(obj.val());
			formSuccess(obj,"{$LANG.VERIFY_SUCCESS}");
		}	
	}); //确认密码验证
		
	{foreach from=$field_list item=field_item}
			{if $field_item.is_must eq 1}			
			$("#settings-{$field_item.field_name}").bind("blur",function(){
				var obj = $(this);
				if(obj.val()=='')
				{
					if (window.PIE) {
					formError(obj.parent(),"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$field_item.field_show_name}");
					}else{
					formError(obj,"{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$field_item.field_show_name}");
					}
					return false;
				}
				if (window.PIE) {
					formSuccess(obj.parent(),"");
				}else{
					formSuccess(obj,"");
				}
			}); //扩展字段		
			{/if}
	{/foreach}
	
	checkReferer();
	$("#settings-referer").bind("blur",function(){
		checkReferer();
	});
});

function  checkReferer(){
	var val = $.trim($("#settings-referer").val());
	if(val==""){
		formSuccess($("#settings-referer"),"");
		return;
	}
	
	var ajaxurl = APP_ROOT+"/index.php?ctl=ajax&act=check_user";
		var query = new Object();
		query.val = val;
		$.ajax({ 
			url: ajaxurl,
			data:query,
			type: "POST",
			dataType: "json",
			success: function(data){
				if(data.status==1)
				{
					formSuccess($("#settings-referer"),"此推荐人信息正确");
					return false;
				}
				else
				{
					formError($("#settings-referer"),"您填写的推荐人信息在本平台不存在，此次输入作为备注。");
					return false;
				}
			}
		});	
}

function checkRegsiter(obj){
	
	if(!$.minLength(obj.find("#signup-username").val(),3,true))
	{
		obj.find("#signup-username").focus();
		$.showErr("{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_NAME}");		
		return false;
	}
	if(!$.maxLength(obj.find("#signup-username").val(),16,true))
	{
		obj.find("#signup-username").focus();
		$.showErr("{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_NAME}");			
		return false;
	}
	
	{if (app_conf("REGISTER_TYPE") eq 0 || app_conf("REGISTER_TYPE") eq 1)}	/*xsz*/
		if(!$.checkMobilePhone($("#settings-mobile").val()))
		{
			$("#settings-mobile").focus();			
			$.showErr("{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");	
			return false;
		}	
		if($.trim($("#settings-mobile").val()).length == 0)
		{
			$("#settings-mobile").focus();
			$.showErr("{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_MOBILE}");
			return false;
		}
	{/if}
	
	{if (app_conf("REGISTER_TYPE") eq 0 || app_conf("REGISTER_TYPE") eq 2)}	
		if($.trim($("#signup-email-address").val()).length == 0 )
		{
			$("#signup-email-address").focus();
			$.showErr("{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");
			return false;
		}
		if(!$.checkEmail($("#signup-email-address").val()))
		{
			$("#signup-email-address").focus();			
			$.showErr("{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_EMAIL}");
			return false;
		}
	{/if}
	
	

	if(!$.minLength(obj.find("#signup-password").val(),4,false))
	{
		obj.find("#signup-password").focus();
		$.showErr("{function name="sprintf" format=$LANG.FORMAT_ERROR_TIP value=$LANG.USER_TITLE_USER_PWD}");	
		return false;
	}
	if(obj.find("#signup-password-confirm").val()!==""){
		if(obj.find("#signup-password-confirm").val() != obj.find("#signup-password").val())
		{
			obj.find("#signup-password-confirm").focus();
			$.showErr("{$LANG.USER_PWD_CONFIRM_ERROR}");			
			return false;
		}
	}
	else{
		obj.find("#signup-password-confirm").focus();
		$.showErr("请输入确认密码");			
		return false;
	}//密码



	{foreach from=$field_list item=field_item}
		{if $field_item.is_must eq 1}
		if(obj.find("#settings-{$field_item.field_name}").val()=='')
		{
			$.showErr("{function name="sprintf" format=$LANG.EMPTY_ERROR_TIP value=$field_item.field_show_name}");	
			obj.find("#settings-{$field_item.field_name}").focus();
			return false;
		}
		{/if}
	{/foreach}

	
	if(obj.find("#J_agreement:checked").length == 0){
		$.showErr("请先同意  注册协议 和 隐私条款");
		return false;
	}
	
	return true;
}
</script>
<div class="blank20"></div>
{include file="inc/footer.html"}